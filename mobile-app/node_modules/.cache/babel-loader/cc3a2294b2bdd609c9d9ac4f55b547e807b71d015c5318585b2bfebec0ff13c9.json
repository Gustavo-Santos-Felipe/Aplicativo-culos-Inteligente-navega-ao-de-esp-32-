{"ast":null,"code":"import _objectSpread from\"C:/esp32-navigation-app/mobile-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useEffect,useCallback}from'react';export const useOffline=()=>{const[isOnline,setIsOnline]=useState(navigator.onLine);const[isInstalled,setIsInstalled]=useState(false);const[showInstallPrompt,setShowInstallPrompt]=useState(false);const[deferredPrompt,setDeferredPrompt]=useState(null);// Monitorar status online/offline\nuseEffect(()=>{const handleOnline=()=>setIsOnline(true);const handleOffline=()=>setIsOnline(false);window.addEventListener('online',handleOnline);window.addEventListener('offline',handleOffline);return()=>{window.removeEventListener('online',handleOnline);window.removeEventListener('offline',handleOffline);};},[]);// Verificar se é PWA instalado\nuseEffect(()=>{const checkIfInstalled=()=>{if(window.matchMedia('(display-mode: standalone)').matches||window.navigator.standalone===true){setIsInstalled(true);}};checkIfInstalled();},[]);// Capturar prompt de instalação\nuseEffect(()=>{const handleBeforeInstallPrompt=e=>{e.preventDefault();setDeferredPrompt(e);setShowInstallPrompt(true);};window.addEventListener('beforeinstallprompt',handleBeforeInstallPrompt);return()=>{window.removeEventListener('beforeinstallprompt',handleBeforeInstallPrompt);};},[]);// Instalar PWA\nconst installPWA=useCallback(async()=>{if(deferredPrompt){deferredPrompt.prompt();const{outcome}=await deferredPrompt.userChoice;if(outcome==='accepted'){setIsInstalled(true);setShowInstallPrompt(false);}setDeferredPrompt(null);}},[deferredPrompt]);// Salvar dados offline\nconst saveOfflineData=useCallback(data=>{try{const currentData=getOfflineData();const newData=_objectSpread(_objectSpread(_objectSpread({},currentData),data),{},{lastSync:Date.now()});localStorage.setItem('castrilha_offline_data',JSON.stringify(newData));}catch(error){console.error('Erro ao salvar dados offline:',error);}},[]);// Carregar dados offline\nconst getOfflineData=useCallback(()=>{try{const data=localStorage.getItem('castrilha_offline_data');if(data){return JSON.parse(data);}}catch(error){console.error('Erro ao carregar dados offline:',error);}return{savedRoutes:[],userPreferences:{volume:0.5,soundEnabled:true,theme:'default'},lastSync:Date.now()};},[]);// Sincronizar dados quando online\nconst syncData=useCallback(async()=>{if(!isOnline)return;try{const offlineData=getOfflineData();const lastSync=offlineData.lastSync;// Aqui você pode implementar sincronização com servidor\nconsole.log('Sincronizando dados...',{lastSync,isOnline});// Simular sincronização\nawait new Promise(resolve=>setTimeout(resolve,1000));// Atualizar timestamp de sincronização\nsaveOfflineData({lastSync:Date.now()});}catch(error){console.error('Erro na sincronização:',error);}},[isOnline,getOfflineData,saveOfflineData]);// Registrar service worker\nconst registerServiceWorker=useCallback(async()=>{if('serviceWorker'in navigator){try{const registration=await navigator.serviceWorker.register('/sw.js');console.log('Service Worker registrado:',registration);return registration;}catch(error){console.error('Erro ao registrar Service Worker:',error);}}},[]);// Solicitar notificações\nconst requestNotifications=useCallback(async()=>{if('Notification'in window&&Notification.permission==='default'){const permission=await Notification.requestPermission();return permission==='granted';}return Notification.permission==='granted';},[]);// Enviar notificação\nconst sendNotification=useCallback((title,options)=>{if('Notification'in window&&Notification.permission==='granted'){new Notification(title,_objectSpread({icon:'/assets/glasses-logo-small.png',badge:'/assets/glasses-logo-small.png'},options));}},[]);return{isOnline,isInstalled,showInstallPrompt,installPWA,saveOfflineData,getOfflineData,syncData,registerServiceWorker,requestNotifications,sendNotification};};","map":{"version":3,"names":["useState","useEffect","useCallback","useOffline","isOnline","setIsOnline","navigator","onLine","isInstalled","setIsInstalled","showInstallPrompt","setShowInstallPrompt","deferredPrompt","setDeferredPrompt","handleOnline","handleOffline","window","addEventListener","removeEventListener","checkIfInstalled","matchMedia","matches","standalone","handleBeforeInstallPrompt","e","preventDefault","installPWA","prompt","outcome","userChoice","saveOfflineData","data","currentData","getOfflineData","newData","_objectSpread","lastSync","Date","now","localStorage","setItem","JSON","stringify","error","console","getItem","parse","savedRoutes","userPreferences","volume","soundEnabled","theme","syncData","offlineData","log","Promise","resolve","setTimeout","registerServiceWorker","registration","serviceWorker","register","requestNotifications","Notification","permission","requestPermission","sendNotification","title","options","icon","badge"],"sources":["C:/esp32-navigation-app/mobile-app/src/hooks/useOffline.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\n\r\ninterface OfflineData {\r\n  savedRoutes: any[];\r\n  userPreferences: {\r\n    volume: number;\r\n    soundEnabled: boolean;\r\n    theme: string;\r\n  };\r\n  lastSync: number;\r\n}\r\n\r\nexport const useOffline = () => {\r\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\r\n  const [isInstalled, setIsInstalled] = useState(false);\r\n  const [showInstallPrompt, setShowInstallPrompt] = useState(false);\r\n  const [deferredPrompt, setDeferredPrompt] = useState<any>(null);\r\n\r\n  // Monitorar status online/offline\r\n  useEffect(() => {\r\n    const handleOnline = () => setIsOnline(true);\r\n    const handleOffline = () => setIsOnline(false);\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, []);\r\n\r\n  // Verificar se é PWA instalado\r\n  useEffect(() => {\r\n    const checkIfInstalled = () => {\r\n      if (window.matchMedia('(display-mode: standalone)').matches ||\r\n          (window.navigator as any).standalone === true) {\r\n        setIsInstalled(true);\r\n      }\r\n    };\r\n\r\n    checkIfInstalled();\r\n  }, []);\r\n\r\n  // Capturar prompt de instalação\r\n  useEffect(() => {\r\n    const handleBeforeInstallPrompt = (e: Event) => {\r\n      e.preventDefault();\r\n      setDeferredPrompt(e);\r\n      setShowInstallPrompt(true);\r\n    };\r\n\r\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n\r\n    return () => {\r\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n    };\r\n  }, []);\r\n\r\n  // Instalar PWA\r\n  const installPWA = useCallback(async () => {\r\n    if (deferredPrompt) {\r\n      deferredPrompt.prompt();\r\n      const { outcome } = await deferredPrompt.userChoice;\r\n      \r\n      if (outcome === 'accepted') {\r\n        setIsInstalled(true);\r\n        setShowInstallPrompt(false);\r\n      }\r\n      \r\n      setDeferredPrompt(null);\r\n    }\r\n  }, [deferredPrompt]);\r\n\r\n  // Salvar dados offline\r\n  const saveOfflineData = useCallback((data: Partial<OfflineData>) => {\r\n    try {\r\n      const currentData = getOfflineData();\r\n      const newData = { ...currentData, ...data, lastSync: Date.now() };\r\n      localStorage.setItem('castrilha_offline_data', JSON.stringify(newData));\r\n    } catch (error) {\r\n      console.error('Erro ao salvar dados offline:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Carregar dados offline\r\n  const getOfflineData = useCallback((): OfflineData => {\r\n    try {\r\n      const data = localStorage.getItem('castrilha_offline_data');\r\n      if (data) {\r\n        return JSON.parse(data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Erro ao carregar dados offline:', error);\r\n    }\r\n\r\n    return {\r\n      savedRoutes: [],\r\n      userPreferences: {\r\n        volume: 0.5,\r\n        soundEnabled: true,\r\n        theme: 'default'\r\n      },\r\n      lastSync: Date.now()\r\n    };\r\n  }, []);\r\n\r\n  // Sincronizar dados quando online\r\n  const syncData = useCallback(async () => {\r\n    if (!isOnline) return;\r\n\r\n    try {\r\n      const offlineData = getOfflineData();\r\n      const lastSync = offlineData.lastSync;\r\n\r\n      // Aqui você pode implementar sincronização com servidor\r\n      console.log('Sincronizando dados...', { lastSync, isOnline });\r\n\r\n      // Simular sincronização\r\n      await new Promise(resolve => setTimeout(resolve, 1000));\r\n      \r\n      // Atualizar timestamp de sincronização\r\n      saveOfflineData({ lastSync: Date.now() });\r\n      \r\n    } catch (error) {\r\n      console.error('Erro na sincronização:', error);\r\n    }\r\n  }, [isOnline, getOfflineData, saveOfflineData]);\r\n\r\n  // Registrar service worker\r\n  const registerServiceWorker = useCallback(async () => {\r\n    if ('serviceWorker' in navigator) {\r\n      try {\r\n        const registration = await navigator.serviceWorker.register('/sw.js');\r\n        console.log('Service Worker registrado:', registration);\r\n        return registration;\r\n      } catch (error) {\r\n        console.error('Erro ao registrar Service Worker:', error);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Solicitar notificações\r\n  const requestNotifications = useCallback(async () => {\r\n    if ('Notification' in window && Notification.permission === 'default') {\r\n      const permission = await Notification.requestPermission();\r\n      return permission === 'granted';\r\n    }\r\n    return Notification.permission === 'granted';\r\n  }, []);\r\n\r\n  // Enviar notificação\r\n  const sendNotification = useCallback((title: string, options?: NotificationOptions) => {\r\n    if ('Notification' in window && Notification.permission === 'granted') {\r\n      new Notification(title, {\r\n        icon: '/assets/glasses-logo-small.png',\r\n        badge: '/assets/glasses-logo-small.png',\r\n        ...options\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    isOnline,\r\n    isInstalled,\r\n    showInstallPrompt,\r\n    installPWA,\r\n    saveOfflineData,\r\n    getOfflineData,\r\n    syncData,\r\n    registerServiceWorker,\r\n    requestNotifications,\r\n    sendNotification\r\n  };\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}