{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useCallback } from 'react';\nexport const useOffline = () => {\n  _s();\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\n  const [isInstalled, setIsInstalled] = useState(false);\n  const [showInstallPrompt, setShowInstallPrompt] = useState(false);\n  const [deferredPrompt, setDeferredPrompt] = useState(null);\n\n  // Monitorar status online/offline\n  useEffect(() => {\n    const handleOnline = () => setIsOnline(true);\n    const handleOffline = () => setIsOnline(false);\n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  // Verificar se é PWA instalado\n  useEffect(() => {\n    const checkIfInstalled = () => {\n      if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {\n        setIsInstalled(true);\n      }\n    };\n    checkIfInstalled();\n  }, []);\n\n  // Capturar prompt de instalação\n  useEffect(() => {\n    const handleBeforeInstallPrompt = e => {\n      e.preventDefault();\n      setDeferredPrompt(e);\n      setShowInstallPrompt(true);\n    };\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    };\n  }, []);\n\n  // Instalar PWA\n  const installPWA = useCallback(async () => {\n    if (deferredPrompt) {\n      deferredPrompt.prompt();\n      const {\n        outcome\n      } = await deferredPrompt.userChoice;\n      if (outcome === 'accepted') {\n        setIsInstalled(true);\n        setShowInstallPrompt(false);\n      }\n      setDeferredPrompt(null);\n    }\n  }, [deferredPrompt]);\n\n  // Salvar dados offline\n  const saveOfflineData = useCallback(data => {\n    try {\n      const currentData = getOfflineData();\n      const newData = {\n        ...currentData,\n        ...data,\n        lastSync: Date.now()\n      };\n      localStorage.setItem('castrilha_offline_data', JSON.stringify(newData));\n    } catch (error) {\n      console.error('Erro ao salvar dados offline:', error);\n    }\n  }, []);\n\n  // Carregar dados offline\n  const getOfflineData = useCallback(() => {\n    try {\n      const data = localStorage.getItem('castrilha_offline_data');\n      if (data) {\n        return JSON.parse(data);\n      }\n    } catch (error) {\n      console.error('Erro ao carregar dados offline:', error);\n    }\n    return {\n      savedRoutes: [],\n      userPreferences: {\n        volume: 0.5,\n        soundEnabled: true,\n        theme: 'default'\n      },\n      lastSync: Date.now()\n    };\n  }, []);\n\n  // Sincronizar dados quando online\n  const syncData = useCallback(async () => {\n    if (!isOnline) return;\n    try {\n      const offlineData = getOfflineData();\n      const lastSync = offlineData.lastSync;\n\n      // Aqui você pode implementar sincronização com servidor\n      console.log('Sincronizando dados...', {\n        lastSync,\n        isOnline\n      });\n\n      // Simular sincronização\n      await new Promise(resolve => setTimeout(resolve, 1000));\n\n      // Atualizar timestamp de sincronização\n      saveOfflineData({\n        lastSync: Date.now()\n      });\n    } catch (error) {\n      console.error('Erro na sincronização:', error);\n    }\n  }, [isOnline, getOfflineData, saveOfflineData]);\n\n  // Registrar service worker\n  const registerServiceWorker = useCallback(async () => {\n    if ('serviceWorker' in navigator) {\n      try {\n        const registration = await navigator.serviceWorker.register('/sw.js');\n        console.log('Service Worker registrado:', registration);\n        return registration;\n      } catch (error) {\n        console.error('Erro ao registrar Service Worker:', error);\n      }\n    }\n  }, []);\n\n  // Solicitar notificações\n  const requestNotifications = useCallback(async () => {\n    if ('Notification' in window && Notification.permission === 'default') {\n      const permission = await Notification.requestPermission();\n      return permission === 'granted';\n    }\n    return Notification.permission === 'granted';\n  }, []);\n\n  // Enviar notificação\n  const sendNotification = useCallback((title, options) => {\n    if ('Notification' in window && Notification.permission === 'granted') {\n      new Notification(title, {\n        icon: '/assets/glasses-logo-small.png',\n        badge: '/assets/glasses-logo-small.png',\n        ...options\n      });\n    }\n  }, []);\n  return {\n    isOnline,\n    isInstalled,\n    showInstallPrompt,\n    installPWA,\n    saveOfflineData,\n    getOfflineData,\n    syncData,\n    registerServiceWorker,\n    requestNotifications,\n    sendNotification\n  };\n};\n_s(useOffline, \"0wBRj06T/wVuQtdk9juv8IdFii8=\");","map":{"version":3,"names":["useState","useEffect","useCallback","useOffline","_s","isOnline","setIsOnline","navigator","onLine","isInstalled","setIsInstalled","showInstallPrompt","setShowInstallPrompt","deferredPrompt","setDeferredPrompt","handleOnline","handleOffline","window","addEventListener","removeEventListener","checkIfInstalled","matchMedia","matches","standalone","handleBeforeInstallPrompt","e","preventDefault","installPWA","prompt","outcome","userChoice","saveOfflineData","data","currentData","getOfflineData","newData","lastSync","Date","now","localStorage","setItem","JSON","stringify","error","console","getItem","parse","savedRoutes","userPreferences","volume","soundEnabled","theme","syncData","offlineData","log","Promise","resolve","setTimeout","registerServiceWorker","registration","serviceWorker","register","requestNotifications","Notification","permission","requestPermission","sendNotification","title","options","icon","badge"],"sources":["C:/esp32-navigation-app/mobile-app/src/hooks/useOffline.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\n\r\ninterface OfflineData {\r\n  savedRoutes: any[];\r\n  userPreferences: {\r\n    volume: number;\r\n    soundEnabled: boolean;\r\n    theme: string;\r\n  };\r\n  lastSync: number;\r\n}\r\n\r\nexport const useOffline = () => {\r\n  const [isOnline, setIsOnline] = useState(navigator.onLine);\r\n  const [isInstalled, setIsInstalled] = useState(false);\r\n  const [showInstallPrompt, setShowInstallPrompt] = useState(false);\r\n  const [deferredPrompt, setDeferredPrompt] = useState<any>(null);\r\n\r\n  // Monitorar status online/offline\r\n  useEffect(() => {\r\n    const handleOnline = () => setIsOnline(true);\r\n    const handleOffline = () => setIsOnline(false);\r\n\r\n    window.addEventListener('online', handleOnline);\r\n    window.addEventListener('offline', handleOffline);\r\n\r\n    return () => {\r\n      window.removeEventListener('online', handleOnline);\r\n      window.removeEventListener('offline', handleOffline);\r\n    };\r\n  }, []);\r\n\r\n  // Verificar se é PWA instalado\r\n  useEffect(() => {\r\n    const checkIfInstalled = () => {\r\n      if (window.matchMedia('(display-mode: standalone)').matches ||\r\n          (window.navigator as any).standalone === true) {\r\n        setIsInstalled(true);\r\n      }\r\n    };\r\n\r\n    checkIfInstalled();\r\n  }, []);\r\n\r\n  // Capturar prompt de instalação\r\n  useEffect(() => {\r\n    const handleBeforeInstallPrompt = (e: Event) => {\r\n      e.preventDefault();\r\n      setDeferredPrompt(e);\r\n      setShowInstallPrompt(true);\r\n    };\r\n\r\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n\r\n    return () => {\r\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\r\n    };\r\n  }, []);\r\n\r\n  // Instalar PWA\r\n  const installPWA = useCallback(async () => {\r\n    if (deferredPrompt) {\r\n      deferredPrompt.prompt();\r\n      const { outcome } = await deferredPrompt.userChoice;\r\n      \r\n      if (outcome === 'accepted') {\r\n        setIsInstalled(true);\r\n        setShowInstallPrompt(false);\r\n      }\r\n      \r\n      setDeferredPrompt(null);\r\n    }\r\n  }, [deferredPrompt]);\r\n\r\n  // Salvar dados offline\r\n  const saveOfflineData = useCallback((data: Partial<OfflineData>) => {\r\n    try {\r\n      const currentData = getOfflineData();\r\n      const newData = { ...currentData, ...data, lastSync: Date.now() };\r\n      localStorage.setItem('castrilha_offline_data', JSON.stringify(newData));\r\n    } catch (error) {\r\n      console.error('Erro ao salvar dados offline:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Carregar dados offline\r\n  const getOfflineData = useCallback((): OfflineData => {\r\n    try {\r\n      const data = localStorage.getItem('castrilha_offline_data');\r\n      if (data) {\r\n        return JSON.parse(data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Erro ao carregar dados offline:', error);\r\n    }\r\n\r\n    return {\r\n      savedRoutes: [],\r\n      userPreferences: {\r\n        volume: 0.5,\r\n        soundEnabled: true,\r\n        theme: 'default'\r\n      },\r\n      lastSync: Date.now()\r\n    };\r\n  }, []);\r\n\r\n  // Sincronizar dados quando online\r\n  const syncData = useCallback(async () => {\r\n    if (!isOnline) return;\r\n\r\n    try {\r\n      const offlineData = getOfflineData();\r\n      const lastSync = offlineData.lastSync;\r\n\r\n      // Aqui você pode implementar sincronização com servidor\r\n      console.log('Sincronizando dados...', { lastSync, isOnline });\r\n\r\n      // Simular sincronização\r\n      await new Promise(resolve => setTimeout(resolve, 1000));\r\n      \r\n      // Atualizar timestamp de sincronização\r\n      saveOfflineData({ lastSync: Date.now() });\r\n      \r\n    } catch (error) {\r\n      console.error('Erro na sincronização:', error);\r\n    }\r\n  }, [isOnline, getOfflineData, saveOfflineData]);\r\n\r\n  // Registrar service worker\r\n  const registerServiceWorker = useCallback(async () => {\r\n    if ('serviceWorker' in navigator) {\r\n      try {\r\n        const registration = await navigator.serviceWorker.register('/sw.js');\r\n        console.log('Service Worker registrado:', registration);\r\n        return registration;\r\n      } catch (error) {\r\n        console.error('Erro ao registrar Service Worker:', error);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Solicitar notificações\r\n  const requestNotifications = useCallback(async () => {\r\n    if ('Notification' in window && Notification.permission === 'default') {\r\n      const permission = await Notification.requestPermission();\r\n      return permission === 'granted';\r\n    }\r\n    return Notification.permission === 'granted';\r\n  }, []);\r\n\r\n  // Enviar notificação\r\n  const sendNotification = useCallback((title: string, options?: NotificationOptions) => {\r\n    if ('Notification' in window && Notification.permission === 'granted') {\r\n      new Notification(title, {\r\n        icon: '/assets/glasses-logo-small.png',\r\n        badge: '/assets/glasses-logo-small.png',\r\n        ...options\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    isOnline,\r\n    isInstalled,\r\n    showInstallPrompt,\r\n    installPWA,\r\n    saveOfflineData,\r\n    getOfflineData,\r\n    syncData,\r\n    registerServiceWorker,\r\n    requestNotifications,\r\n    sendNotification\r\n  };\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}