{"ast":null,"code":"var _jsxFileName = \"C:\\\\esp32-navigation-app\\\\mobile-app\\\\src\\\\App.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { GoogleMap, useJsApiLoader, Marker, Autocomplete, DirectionsRenderer } from '@react-google-maps/api';\n\n// ##################################################################\n// # COLOQUE SUAS CHAVES E IPs AQUI                                 #\n// ##################################################################\n\n// 1. CHAVE DA API GOOGLE MAPS PLATFORM\n//    Ative as APIs: \"Maps JavaScript API\", \"Directions API\", \"Places API\"\n//    Instruções: https://developers.google.com/maps/gmp-get-started\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst GOOGLE_MAPS_API_KEY = \"AIzaSyAVEzH5bvFPDpgjQtnA4s2TKfjEW_0OTLY\";\n\n// 2. ENDEREÇO IP DO ESP32\n//    Este é o IP que o ESP32 assume quando está em modo Access Point (AP).\nconst ESP32_IP_ADDRESS = \"192.168.4.1\";\n\n// ##################################################################\n\n// Interface para a estrutura da rota salva\n\nconst containerStyle = {\n  width: '100%',\n  height: '100%'\n};\n\n// Adicionando uma constante para a distância de gatilho\nconst NAVIGATION_TRIGGER_DISTANCE_METERS = 50; // Dispara o envio da instrução a 50 metros\n\nconst libraries = [\"places\"];\nfunction App() {\n  _s();\n  const {\n    isLoaded\n  } = useJsApiLoader({\n    id: 'google-map-script',\n    googleMapsApiKey: GOOGLE_MAPS_API_KEY,\n    libraries\n  });\n  const [map, setMap] = useState(null);\n  const [directionsResponse, setDirectionsResponse] = useState(null);\n  const [currentPosition, setCurrentPosition] = useState(null);\n  const [simplifiedInstructions, setSimplifiedInstructions] = useState([]);\n\n  // Novos estados para gerenciar a navegação e rotas salvas\n  const [isNavigating, setIsNavigating] = useState(false);\n  const [currentStepIndex, setCurrentStepIndex] = useState(0);\n  const [savedRoutes, setSavedRoutes] = useState([]);\n  const locationWatcherId = useRef(null);\n  const destinationRef = useRef(null);\n  useEffect(() => {\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(position => {\n        const pos = {\n          lat: position.coords.latitude,\n          lng: position.coords.longitude\n        };\n        setCurrentPosition(pos);\n        map === null || map === void 0 ? void 0 : map.panTo(pos);\n      }, () => {\n        alert(\"Erro: O serviço de geolocalização falhou.\");\n      });\n    } else {\n      alert(\"Erro: Seu navegador não suporta geolocalização.\");\n    }\n  }, [map]);\n\n  // Efeito para carregar as rotas salvas do localStorage ao iniciar\n  useEffect(() => {\n    try {\n      const routesFromStorage = localStorage.getItem('savedNavigationRoutes');\n      if (routesFromStorage) {\n        setSavedRoutes(JSON.parse(routesFromStorage));\n      }\n    } catch (error) {\n      console.error(\"Erro ao carregar rotas do localStorage:\", error);\n      // Opcional: Limpar dados corrompidos\n      // localStorage.removeItem('savedNavigationRoutes');\n    }\n  }, []);\n\n  // Nova função para calcular a distância entre dois pontos de GPS (fórmula de Haversine)\n  const getDistanceInMeters = (pos1, pos2) => {\n    const R = 6371e3; // Metros\n    const p1 = pos1.lat * Math.PI / 180;\n    const p2 = pos2.lat * Math.PI / 180;\n    const deltaP = (pos2.lat - pos1.lat) * Math.PI / 180;\n    const deltaL = (pos2.lng - pos1.lng) * Math.PI / 180;\n    const a = Math.sin(deltaP / 2) * Math.sin(deltaP / 2) + Math.cos(p1) * Math.cos(p2) * Math.sin(deltaL / 2) * Math.sin(deltaL / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c; // em metros\n  };\n  const calculateRoute = async () => {\n    var _destinationRef$curre;\n    if (!((_destinationRef$curre = destinationRef.current) !== null && _destinationRef$curre !== void 0 && _destinationRef$curre.value) || !currentPosition) {\n      return;\n    }\n    const directionsService = new google.maps.DirectionsService();\n    const results = await directionsService.route({\n      origin: currentPosition,\n      destination: destinationRef.current.value,\n      travelMode: google.maps.TravelMode.DRIVING,\n      language: 'pt-BR' // Instruções em Português\n    });\n    setDirectionsResponse(results);\n    generateSimplifiedInstructions(results);\n  };\n  const generateSimplifiedInstructions = directions => {\n    if (!directions.routes || directions.routes.length === 0) {\n      return;\n    }\n    const route = directions.routes[0].legs[0];\n    const instructions = route.steps.map(step => {\n      var _step$distance;\n      // Remove tags HTML da instrução (ex: <b>, <div>)\n      const cleanInstruction = step.instructions.replace(/<[^>]*>/g, '');\n      const distance = ((_step$distance = step.distance) === null || _step$distance === void 0 ? void 0 : _step$distance.text) || '';\n      return `${cleanInstruction} (${distance})`;\n    });\n    setSimplifiedInstructions(instructions);\n  };\n\n  // Funções para gerenciar rotas salvas\n  const saveCurrentRoute = () => {\n    var _destinationRef$curre2;\n    if (!directionsResponse || !((_destinationRef$curre2 = destinationRef.current) !== null && _destinationRef$curre2 !== void 0 && _destinationRef$curre2.value)) {\n      alert(\"Nenhuma rota calculada para salvar.\");\n      return;\n    }\n    const routeName = destinationRef.current.value;\n\n    // Verifica se uma rota com o mesmo nome já existe\n    if (savedRoutes.some(route => route.name === routeName)) {\n      if (!window.confirm(`Uma rota para \"${routeName}\" já existe. Deseja substituí-la?`)) {\n        return;\n      }\n    }\n    const newRoute = {\n      name: routeName,\n      directions: directionsResponse\n    };\n\n    // Filtra a rota antiga (se existir) e adiciona a nova\n    const updatedRoutes = savedRoutes.filter(route => route.name !== routeName);\n    updatedRoutes.push(newRoute);\n    setSavedRoutes(updatedRoutes);\n    localStorage.setItem('savedNavigationRoutes', JSON.stringify(updatedRoutes));\n    alert(`Rota para \"${routeName}\" salva com sucesso!`);\n  };\n  const loadSavedRoute = routeToLoad => {\n    setDirectionsResponse(routeToLoad.directions);\n    generateSimplifiedInstructions(routeToLoad.directions);\n    setIsNavigating(false); // Garante que a navegação pare ao carregar nova rota\n    if (destinationRef.current) {\n      destinationRef.current.value = routeToLoad.name;\n    }\n    alert(`Rota para \"${routeToLoad.name}\" carregada.`);\n  };\n  const deleteSavedRoute = indexToDelete => {\n    if (window.confirm(\"Tem certeza que deseja deletar esta rota?\")) {\n      const updatedRoutes = savedRoutes.filter((_, index) => index !== indexToDelete);\n      setSavedRoutes(updatedRoutes);\n      localStorage.setItem('savedNavigationRoutes', JSON.stringify(updatedRoutes));\n    }\n  };\n\n  // Função centralizada para avançar para a próxima instrução\n  const advanceToStep = useCallback(stepIndex => {\n    if (!directionsResponse) return;\n    const route = directionsResponse.routes[0].legs[0];\n    if (stepIndex >= route.steps.length) {\n      sendSingleInstructionToESP32(\"Você chegou ao seu destino!\");\n      stopNavigation();\n      return;\n    }\n    const step = route.steps[stepIndex];\n    const instructionText = step.instructions.replace(/<[^>]*>/g, '');\n    sendSingleInstructionToESP32(instructionText);\n    setCurrentStepIndex(prevIndex => prevIndex + 1);\n  }, [directionsResponse]);\n  const sendSingleInstructionToESP32 = async instruction => {\n    const endpoint = `http://${ESP32_IP_ADDRESS}/navigate`;\n    console.log(`Enviando instrução para ${endpoint}: ${instruction}`);\n    try {\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        // ATENÇÃO: O formato do body mudou. O ESP32 precisará ser atualizado.\n        body: JSON.stringify({\n          instruction: instruction\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`Falha na resposta do servidor: ${response.status}`);\n      }\n    } catch (error) {\n      console.error(\"Erro ao enviar instrução para o ESP32:\", error);\n      // Não alertar o usuário aqui para não interromper a navegação\n    }\n  };\n  const stopNavigation = () => {\n    if (locationWatcherId.current !== null) {\n      navigator.geolocation.clearWatch(locationWatcherId.current);\n      locationWatcherId.current = null;\n    }\n    setIsNavigating(false);\n    alert(\"Navegação encerrada.\");\n  };\n\n  // Este useEffect é o cérebro da navegação em tempo real\n  useEffect(() => {\n    if (!isNavigating) {\n      return;\n    }\n    const handleLocationUpdate = position => {\n      if (!(directionsResponse !== null && directionsResponse !== void 0 && directionsResponse.routes[0])) {\n        return;\n      }\n      const userPosition = {\n        lat: position.coords.latitude,\n        lng: position.coords.longitude\n      };\n      setCurrentPosition(userPosition); // Atualiza o marcador no mapa\n\n      const route = directionsResponse.routes[0].legs[0];\n      if (currentStepIndex >= route.steps.length) {\n        sendSingleInstructionToESP32(\"Você chegou ao seu destino!\");\n        stopNavigation();\n        return;\n      }\n      const nextStep = route.steps[currentStepIndex];\n      const nextStepLocation = {\n        lat: nextStep.start_location.lat(),\n        lng: nextStep.start_location.lng()\n      };\n      const distance = getDistanceInMeters(userPosition, nextStepLocation);\n      console.log(`Distância para a próxima manobra: ${distance.toFixed(0)} metros.`);\n      if (distance < NAVIGATION_TRIGGER_DISTANCE_METERS) {\n        advanceToStep(currentStepIndex);\n      }\n    };\n    const handleLocationError = error => {\n      alert(`Erro de geolocalização: ${error.message}`);\n      stopNavigation();\n    };\n    locationWatcherId.current = navigator.geolocation.watchPosition(handleLocationUpdate, handleLocationError, {\n      enableHighAccuracy: true,\n      timeout: 10000,\n      maximumAge: 0\n    });\n    return () => {\n      if (locationWatcherId.current !== null) {\n        navigator.geolocation.clearWatch(locationWatcherId.current);\n      }\n    };\n  }, [isNavigating, currentStepIndex, directionsResponse, advanceToStep]);\n  const startNavigation = () => {\n    if (!directionsResponse) {\n      alert(\"É necessário calcular uma rota antes de iniciar a navegação.\");\n      return;\n    }\n    setCurrentStepIndex(0);\n    // Envia a primeira instrução imediatamente ao iniciar\n    advanceToStep(0);\n    setIsNavigating(true);\n    alert(\"Iniciando navegação!\");\n  };\n\n  // Nova função para o botão de teste\n  const forceNextInstruction = () => {\n    advanceToStep(currentStepIndex);\n  };\n  if (!isLoaded) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"Carregando Mapa...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 12\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"sidebar\",\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: \"/assets/Logo_Principal.png\",\n        alt: \"Logo\",\n        className: \"app-logo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 312,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"controls-container\",\n        children: [/*#__PURE__*/_jsxDEV(Autocomplete, {\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Digite o endere\\xE7o de destino\",\n            ref: destinationRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 316,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 315,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: calculateRoute,\n          children: \"Gerar Rota\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 11\n        }, this), directionsResponse && /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: saveCurrentRoute,\n          className: \"save-button\",\n          children: \"Salvar Rota\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 13\n        }, this), !isNavigating ? /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: startNavigation,\n          disabled: !directionsResponse,\n          children: \"Iniciar Navega\\xE7\\xE3o\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 331,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"navigation-controls\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: stopNavigation,\n            className: \"stop-button\",\n            children: \"Parar Navega\\xE7\\xE3o\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: forceNextInstruction,\n            className: \"test-button\",\n            children: \"Pr\\xF3xima (Teste)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 339,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 335,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 314,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"instructions-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Instru\\xE7\\xF5es de Navega\\xE7\\xE3o\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 347,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: simplifiedInstructions.map((inst, index) => /*#__PURE__*/_jsxDEV(\"li\", {\n            children: inst\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 350,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 348,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 346,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"saved-routes-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Rotas Salvas (Modo Offline)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 357,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"offline-instructions\",\n          children: [\"Para usar offline, conecte seu celular na rede Wi-Fi \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"NAV_SYSTEM_WIFI\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 359,\n            columnNumber: 66\n          }, this), \", carregue uma rota e inicie a navega\\xE7\\xE3o.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 358,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          className: \"saved-routes-list\",\n          children: savedRoutes.length > 0 ? savedRoutes.map((route, index) => /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: route.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 365,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"route-actions\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => loadSavedRoute(route),\n                children: \"Carregar\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 367,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => deleteSavedRoute(index),\n                className: \"delete-button\",\n                children: \"Deletar\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 368,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 366,\n              columnNumber: 19\n            }, this)]\n          }, index, true, {\n            fileName: _jsxFileName,\n            lineNumber: 364,\n            columnNumber: 17\n          }, this)) : /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Nenhuma rota salva.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 361,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 356,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 311,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"map-container\",\n      children: /*#__PURE__*/_jsxDEV(GoogleMap, {\n        mapContainerStyle: containerStyle,\n        center: currentPosition || {\n          lat: -23.55052,\n          lng: -46.633308\n        } // Fallback to São Paulo\n        ,\n        zoom: 15,\n        onLoad: map => setMap(map),\n        options: {\n          disableDefaultUI: true,\n          zoomControl: true\n        },\n        children: [currentPosition && /*#__PURE__*/_jsxDEV(Marker, {\n          position: currentPosition\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 387,\n          columnNumber: 31\n        }, this), directionsResponse && /*#__PURE__*/_jsxDEV(DirectionsRenderer, {\n          directions: directionsResponse\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 388,\n          columnNumber: 34\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 379,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 310,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"Yk17eTOwPpW+g00VqkwXaOzo2+c=\", false, function () {\n  return [useJsApiLoader];\n});\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","GoogleMap","useJsApiLoader","Marker","Autocomplete","DirectionsRenderer","jsxDEV","_jsxDEV","GOOGLE_MAPS_API_KEY","ESP32_IP_ADDRESS","containerStyle","width","height","NAVIGATION_TRIGGER_DISTANCE_METERS","libraries","App","_s","isLoaded","id","googleMapsApiKey","map","setMap","directionsResponse","setDirectionsResponse","currentPosition","setCurrentPosition","simplifiedInstructions","setSimplifiedInstructions","isNavigating","setIsNavigating","currentStepIndex","setCurrentStepIndex","savedRoutes","setSavedRoutes","locationWatcherId","destinationRef","navigator","geolocation","getCurrentPosition","position","pos","lat","coords","latitude","lng","longitude","panTo","alert","routesFromStorage","localStorage","getItem","JSON","parse","error","console","getDistanceInMeters","pos1","pos2","R","p1","Math","PI","p2","deltaP","deltaL","a","sin","cos","c","atan2","sqrt","calculateRoute","_destinationRef$curre","current","value","directionsService","google","maps","DirectionsService","results","route","origin","destination","travelMode","TravelMode","DRIVING","language","generateSimplifiedInstructions","directions","routes","length","legs","instructions","steps","step","_step$distance","cleanInstruction","replace","distance","text","saveCurrentRoute","_destinationRef$curre2","routeName","some","name","window","confirm","newRoute","updatedRoutes","filter","push","setItem","stringify","loadSavedRoute","routeToLoad","deleteSavedRoute","indexToDelete","_","index","advanceToStep","stepIndex","sendSingleInstructionToESP32","stopNavigation","instructionText","prevIndex","instruction","endpoint","log","response","fetch","method","headers","body","ok","Error","status","clearWatch","handleLocationUpdate","userPosition","nextStep","nextStepLocation","start_location","toFixed","handleLocationError","message","watchPosition","enableHighAccuracy","timeout","maximumAge","startNavigation","forceNextInstruction","children","fileName","_jsxFileName","lineNumber","columnNumber","className","src","alt","type","placeholder","ref","onClick","disabled","inst","mapContainerStyle","center","zoom","onLoad","options","disableDefaultUI","zoomControl","_c","$RefreshReg$"],"sources":["C:/esp32-navigation-app/mobile-app/src/App.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { GoogleMap, useJsApiLoader, Marker, Autocomplete, DirectionsRenderer } from '@react-google-maps/api';\n\n// ##################################################################\n// # COLOQUE SUAS CHAVES E IPs AQUI                                 #\n// ##################################################################\n\n// 1. CHAVE DA API GOOGLE MAPS PLATFORM\n//    Ative as APIs: \"Maps JavaScript API\", \"Directions API\", \"Places API\"\n//    Instruções: https://developers.google.com/maps/gmp-get-started\nconst GOOGLE_MAPS_API_KEY = \"AIzaSyAVEzH5bvFPDpgjQtnA4s2TKfjEW_0OTLY\";\n\n// 2. ENDEREÇO IP DO ESP32\n//    Este é o IP que o ESP32 assume quando está em modo Access Point (AP).\nconst ESP32_IP_ADDRESS = \"192.168.4.1\";\n\n// ##################################################################\n\n// Interface para a estrutura da rota salva\ninterface SavedRoute {\n  name: string;\n  directions: google.maps.DirectionsResult;\n}\n\nconst containerStyle = {\n  width: '100%',\n  height: '100%'\n};\n\n// Adicionando uma constante para a distância de gatilho\nconst NAVIGATION_TRIGGER_DISTANCE_METERS = 50; // Dispara o envio da instrução a 50 metros\n\nconst libraries: \"places\"[] = [\"places\"];\n\nfunction App() {\n  const { isLoaded } = useJsApiLoader({\n    id: 'google-map-script',\n    googleMapsApiKey: GOOGLE_MAPS_API_KEY,\n    libraries,\n  });\n\n  const [map, setMap] = useState<google.maps.Map | null>(null);\n  const [directionsResponse, setDirectionsResponse] = useState<google.maps.DirectionsResult | null>(null);\n  const [currentPosition, setCurrentPosition] = useState<google.maps.LatLngLiteral | null>(null);\n  const [simplifiedInstructions, setSimplifiedInstructions] = useState<string[]>([]);\n  \n  // Novos estados para gerenciar a navegação e rotas salvas\n  const [isNavigating, setIsNavigating] = useState(false);\n  const [currentStepIndex, setCurrentStepIndex] = useState(0);\n  const [savedRoutes, setSavedRoutes] = useState<SavedRoute[]>([]);\n  const locationWatcherId = useRef<number | null>(null);\n  \n  const destinationRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          const pos = {\n            lat: position.coords.latitude,\n            lng: position.coords.longitude,\n          };\n          setCurrentPosition(pos);\n          map?.panTo(pos);\n        },\n        () => {\n          alert(\"Erro: O serviço de geolocalização falhou.\");\n        }\n      );\n    } else {\n      alert(\"Erro: Seu navegador não suporta geolocalização.\");\n    }\n  }, [map]);\n\n  // Efeito para carregar as rotas salvas do localStorage ao iniciar\n  useEffect(() => {\n    try {\n      const routesFromStorage = localStorage.getItem('savedNavigationRoutes');\n      if (routesFromStorage) {\n        setSavedRoutes(JSON.parse(routesFromStorage));\n      }\n    } catch (error) {\n      console.error(\"Erro ao carregar rotas do localStorage:\", error);\n      // Opcional: Limpar dados corrompidos\n      // localStorage.removeItem('savedNavigationRoutes');\n    }\n  }, []);\n\n  // Nova função para calcular a distância entre dois pontos de GPS (fórmula de Haversine)\n  const getDistanceInMeters = (pos1: google.maps.LatLngLiteral, pos2: google.maps.LatLngLiteral) => {\n    const R = 6371e3; // Metros\n    const p1 = (pos1.lat * Math.PI) / 180;\n    const p2 = (pos2.lat * Math.PI) / 180;\n    const deltaP = ((pos2.lat - pos1.lat) * Math.PI) / 180;\n    const deltaL = ((pos2.lng - pos1.lng) * Math.PI) / 180;\n    const a =\n      Math.sin(deltaP / 2) * Math.sin(deltaP / 2) +\n      Math.cos(p1) * Math.cos(p2) * Math.sin(deltaL / 2) * Math.sin(deltaL / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c; // em metros\n  };\n\n  const calculateRoute = async () => {\n    if (!destinationRef.current?.value || !currentPosition) {\n      return;\n    }\n    \n    const directionsService = new google.maps.DirectionsService();\n    const results = await directionsService.route({\n      origin: currentPosition,\n      destination: destinationRef.current.value,\n      travelMode: google.maps.TravelMode.DRIVING,\n      language: 'pt-BR', // Instruções em Português\n    });\n\n    setDirectionsResponse(results);\n    generateSimplifiedInstructions(results);\n  };\n  \n  const generateSimplifiedInstructions = (directions: google.maps.DirectionsResult) => {\n    if (!directions.routes || directions.routes.length === 0) {\n      return;\n    }\n    const route = directions.routes[0].legs[0];\n    const instructions = route.steps.map((step: google.maps.DirectionsStep) => {\n      // Remove tags HTML da instrução (ex: <b>, <div>)\n      const cleanInstruction = step.instructions.replace(/<[^>]*>/g, '');\n      const distance = step.distance?.text || '';\n      return `${cleanInstruction} (${distance})`;\n    });\n    setSimplifiedInstructions(instructions);\n  };\n\n  // Funções para gerenciar rotas salvas\n  const saveCurrentRoute = () => {\n    if (!directionsResponse || !destinationRef.current?.value) {\n      alert(\"Nenhuma rota calculada para salvar.\");\n      return;\n    }\n\n    const routeName = destinationRef.current.value;\n\n    // Verifica se uma rota com o mesmo nome já existe\n    if (savedRoutes.some(route => route.name === routeName)) {\n      if (!window.confirm(`Uma rota para \"${routeName}\" já existe. Deseja substituí-la?`)) {\n        return;\n      }\n    }\n\n    const newRoute: SavedRoute = {\n      name: routeName,\n      directions: directionsResponse,\n    };\n    \n    // Filtra a rota antiga (se existir) e adiciona a nova\n    const updatedRoutes = savedRoutes.filter(route => route.name !== routeName);\n    updatedRoutes.push(newRoute);\n\n    setSavedRoutes(updatedRoutes);\n    localStorage.setItem('savedNavigationRoutes', JSON.stringify(updatedRoutes));\n    alert(`Rota para \"${routeName}\" salva com sucesso!`);\n  };\n\n  const loadSavedRoute = (routeToLoad: SavedRoute) => {\n    setDirectionsResponse(routeToLoad.directions);\n    generateSimplifiedInstructions(routeToLoad.directions);\n    setIsNavigating(false); // Garante que a navegação pare ao carregar nova rota\n    if (destinationRef.current) {\n        destinationRef.current.value = routeToLoad.name;\n    }\n    alert(`Rota para \"${routeToLoad.name}\" carregada.`);\n  };\n\n  const deleteSavedRoute = (indexToDelete: number) => {\n    if (window.confirm(\"Tem certeza que deseja deletar esta rota?\")) {\n      const updatedRoutes = savedRoutes.filter((_, index) => index !== indexToDelete);\n      setSavedRoutes(updatedRoutes);\n      localStorage.setItem('savedNavigationRoutes', JSON.stringify(updatedRoutes));\n    }\n  };\n\n  // Função centralizada para avançar para a próxima instrução\n  const advanceToStep = useCallback((stepIndex: number) => {\n    if (!directionsResponse) return;\n\n    const route = directionsResponse.routes[0].legs[0];\n    if (stepIndex >= route.steps.length) {\n      sendSingleInstructionToESP32(\"Você chegou ao seu destino!\");\n      stopNavigation();\n      return;\n    }\n\n    const step = route.steps[stepIndex];\n    const instructionText = step.instructions.replace(/<[^>]*>/g, '');\n    sendSingleInstructionToESP32(instructionText);\n    setCurrentStepIndex(prevIndex => prevIndex + 1);\n  }, [directionsResponse]);\n\n  const sendSingleInstructionToESP32 = async (instruction: string) => {\n    const endpoint = `http://${ESP32_IP_ADDRESS}/navigate`;\n    console.log(`Enviando instrução para ${endpoint}: ${instruction}`);\n\n    try {\n      const response = await fetch(endpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        // ATENÇÃO: O formato do body mudou. O ESP32 precisará ser atualizado.\n        body: JSON.stringify({ instruction: instruction }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`Falha na resposta do servidor: ${response.status}`);\n      }\n    } catch (error) {\n      console.error(\"Erro ao enviar instrução para o ESP32:\", error);\n      // Não alertar o usuário aqui para não interromper a navegação\n    }\n  };\n\n  const stopNavigation = () => {\n    if (locationWatcherId.current !== null) {\n      navigator.geolocation.clearWatch(locationWatcherId.current);\n      locationWatcherId.current = null;\n    }\n    setIsNavigating(false);\n    alert(\"Navegação encerrada.\");\n  };\n\n  // Este useEffect é o cérebro da navegação em tempo real\n  useEffect(() => {\n    if (!isNavigating) {\n      return;\n    }\n\n    const handleLocationUpdate = (position: GeolocationPosition) => {\n      if (!directionsResponse?.routes[0]) {\n        return;\n      }\n\n      const userPosition: google.maps.LatLngLiteral = {\n        lat: position.coords.latitude,\n        lng: position.coords.longitude,\n      };\n      setCurrentPosition(userPosition); // Atualiza o marcador no mapa\n\n      const route = directionsResponse.routes[0].legs[0];\n      if (currentStepIndex >= route.steps.length) {\n        sendSingleInstructionToESP32(\"Você chegou ao seu destino!\");\n        stopNavigation();\n        return;\n      }\n\n      const nextStep = route.steps[currentStepIndex];\n      const nextStepLocation: google.maps.LatLngLiteral = {\n        lat: nextStep.start_location.lat(),\n        lng: nextStep.start_location.lng(),\n      };\n\n      const distance = getDistanceInMeters(userPosition, nextStepLocation);\n      console.log(`Distância para a próxima manobra: ${distance.toFixed(0)} metros.`);\n\n      if (distance < NAVIGATION_TRIGGER_DISTANCE_METERS) {\n        advanceToStep(currentStepIndex);\n      }\n    };\n\n    const handleLocationError = (error: GeolocationPositionError) => {\n      alert(`Erro de geolocalização: ${error.message}`);\n      stopNavigation();\n    };\n\n    locationWatcherId.current = navigator.geolocation.watchPosition(\n      handleLocationUpdate,\n      handleLocationError,\n      { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }\n    );\n\n    return () => {\n      if (locationWatcherId.current !== null) {\n        navigator.geolocation.clearWatch(locationWatcherId.current);\n      }\n    };\n  }, [isNavigating, currentStepIndex, directionsResponse, advanceToStep]);\n\n\n  const startNavigation = () => {\n    if (!directionsResponse) {\n      alert(\"É necessário calcular uma rota antes de iniciar a navegação.\");\n      return;\n    }\n    setCurrentStepIndex(0);\n    // Envia a primeira instrução imediatamente ao iniciar\n    advanceToStep(0); \n    setIsNavigating(true);\n    alert(\"Iniciando navegação!\");\n  };\n\n  // Nova função para o botão de teste\n  const forceNextInstruction = () => {\n    advanceToStep(currentStepIndex);\n  };\n\n  if (!isLoaded) {\n    return <div>Carregando Mapa...</div>;\n  }\n\n  return (\n    <div className=\"App\">\n      <div className=\"sidebar\">\n        <img src=\"/assets/Logo_Principal.png\" alt=\"Logo\" className=\"app-logo\" />\n        \n        <div className=\"controls-container\">\n          <Autocomplete>\n            <input\n              type='text'\n              placeholder='Digite o endereço de destino'\n              ref={destinationRef}\n            />\n          </Autocomplete>\n          <button onClick={calculateRoute}>Gerar Rota</button>\n          \n          {directionsResponse && (\n            <button onClick={saveCurrentRoute} className=\"save-button\">\n              Salvar Rota\n            </button>\n          )}\n\n          {!isNavigating ? (\n            <button onClick={startNavigation} disabled={!directionsResponse}>\n              Iniciar Navegação\n            </button>\n          ) : (\n            <div className=\"navigation-controls\">\n              <button onClick={stopNavigation} className=\"stop-button\">\n                Parar Navegação\n              </button>\n              <button onClick={forceNextInstruction} className=\"test-button\">\n                Próxima (Teste)\n              </button>\n            </div>\n          )}\n        </div>\n\n        <div className=\"instructions-container\">\n          <h3>Instruções de Navegação</h3>\n          <ul>\n            {simplifiedInstructions.map((inst, index) => (\n              <li key={index}>{inst}</li>\n            ))}\n          </ul>\n        </div>\n\n        {/* Nova seção para Rotas Salvas */}\n        <div className=\"saved-routes-container\">\n          <h3>Rotas Salvas (Modo Offline)</h3>\n          <p className=\"offline-instructions\">\n            Para usar offline, conecte seu celular na rede Wi-Fi <strong>NAV_SYSTEM_WIFI</strong>, carregue uma rota e inicie a navegação.\n          </p>\n          <ul className=\"saved-routes-list\">\n            {savedRoutes.length > 0 ? (\n              savedRoutes.map((route, index) => (\n                <li key={index}>\n                  <span>{route.name}</span>\n                  <div className=\"route-actions\">\n                    <button onClick={() => loadSavedRoute(route)}>Carregar</button>\n                    <button onClick={() => deleteSavedRoute(index)} className=\"delete-button\">Deletar</button>\n                  </div>\n                </li>\n              ))\n            ) : (\n              <p>Nenhuma rota salva.</p>\n            )}\n          </ul>\n        </div>\n      </div>\n\n      <div className=\"map-container\">\n        <GoogleMap\n          mapContainerStyle={containerStyle}\n          center={currentPosition || { lat: -23.55052, lng: -46.633308 }} // Fallback to São Paulo\n          zoom={15}\n          onLoad={(map: google.maps.Map) => setMap(map)}\n          options={{disableDefaultUI: true, zoomControl: true}}\n        >\n          {currentPosition && <Marker position={currentPosition} />}\n          {directionsResponse && <DirectionsRenderer directions={directionsResponse} />}\n        </GoogleMap>\n      </div>\n    </div>\n  );\n}\n\nexport default App; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}